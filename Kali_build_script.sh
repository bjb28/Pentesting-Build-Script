#!/bin/bash

if [ -z "$1" ]
then 
	echo 'USAGE: sudo ./Kali_build_script.sh <Your User Account>'
	exit
fi

#Link pip to pip3
sudo ln -s /usr/bin/pip3 /usr/bin/pip

#Weird LIBC6 error fix -required prior to upgrading Kali 2020..
sudo apt-get -y install gcc-9-base libgcc-9-dev libc6-dev;


#Update Kali before starting
echo -e  '\e[1;34m'"{::Starting Kali update before installs::}"'\e[0m'
sudo apt-get update && sudo DEBIAN_FRONTEND=noninteractive apt-get -y upgrade && sudo DEBIAN_FRONTEND=noninteractive apt-get -y dist-upgrade && sudo apt-get -y autoclean && sudo apt-get -y autoremove


#Build Tools Directories (both in root and OPT depending on user preference)
echo -e  '\e[1;34m'"{::Creating linked Tool directories ~/Tools and /OPT/Tools::}"'\e[0m'
mkdir -p /opt/Tools

#Install Sublime Text Editor
echo -e  '\e[1;34m'"{::Installing Sublime Text Editor::}"'\e[0m'
wget -qO - https://download.sublimetext.com/sublimehq-pub.gpg | sudo apt-key add -
sudo DEBIAN_FRONTEND=noninteractive apt-get -y install apt-transport-https
echo -e  "deb https://download.sublimetext.com/ apt/stable/" | sudo tee /etc/apt/sources.list.d/sublime-text.list
sudo apt-get -y update && sudo DEBIAN_FRONTEND=noninteractive apt-get -y install sublime-text


#Install Terminator
echo -e  '\e[1;34m'"{::Installing Terminator::}"'\e[0m'
DEBIAN_FRONTEND=noninteractive apt-get -y install terminator


# Git Clones of Tools
echo -e  '\e[1;34m'"{::Performing GIT clones of tools from GitHub::}"'\e[0m'
cd /opt/Tools
git clone https://github.com/Tib3rius/AutoRecon.git 2> /dev/nul
git clone https://github.com/samratashok/nishang.git 2> /dev/nul
git clone https://github.com/3ndG4me/AutoBlue-MS17-010.git 2> /dev/nul
git clone https://github.com/BC-SECURITY/Empire.git 2> /dev/nul
git clone https://github.com/PowerShellMafia/PowerSploit.git 2> /dev/nul
git clone https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite.git 2> /dev/nul
git clone https://github.com/rasta-mouse/Sherlock.git 2> /dev/nul
git clone https://github.com/rasta-mouse/Watson.git 2> /dev/nul
git clone https://github.com/sleventyeleven/linuxprivchecker.git 2> /dev/nul
git clone https://github.com/411Hall/JAWS.git 2> /dev/nul
git clone https://github.com/SecureAuthCorp/impacket.git 2> /dev/nul
git clone https://github.com/vulnersCom/nmap-vulners.git 2> /dev/nul
git clone https://github.com/swisskyrepo/PayloadsAllTheThings.git 2> /dev/nul
git clone https://github.com/BloodHoundAD/BloodHound.git 2> /dev/nul
git clone https://github.com/ropnop/kerbrute.git 2> /dev/nul
git clone https://github.com/rebootuser/LinEnum.git 2> /dev/nul
git clone https://github.com/AonCyberLabs/Windows-Exploit-Suggester.git 2> /dev/nul
git clone https://github.com/D35m0nd142/LFISuite.git 2> /dev/nul
git clone https://github.com/mdsecactivebreach/SharpShooter.git 2> /dev/nul
git clone https://github.com/vysecurity/morphHTA.git 2> /dev/nul
git clone https://github.com/Kevin-Robertson/Inveigh.git 2> /dev/nul
git clone https://github.com/noahpowers/ServerSetup.git 2> /dev/nul
git clone https://github.com/jasonjfrank/gnmap-parser.git 2> /dev/nul
git clone https://github.com/GhostPack/SharpDPAPI.git 2> /dev/nul
git clone https://github.com/GhostPack/Seatbelt.git 2> /dev/nul
git clone https://github.com/GhostPack/Rubeus.git 2> /dev/nul
git clone https://github.com/GhostPack/SharpWMI.git 2> /dev/nul
git clone https://github.com/GhostPack/Lockless.git 2> /dev/nul
git clone https://github.com/GhostPack/Sharpup.git 2> /dev/nul
git clone https://github.com/GhostPack/SafetyKatz.git 2> /dev/nul
git clone https://github.com/GhostPack/SharpDump.git 2> /dev/nul
git clone https://github.com/GhostPack/SharpRoast.git 2> /dev/nul
git clone https://github.com/mdsecactivebreach/CACTUSTORCH.git 2> /dev/nul
git clone https://github.com/Techno-Hwizrdry/checkpwnedemails.git 2> /dev/nul
git clone https://github.com/bovine/datapipe.git 2> /dev/null
git clone https://github.com/nccgroup/demiguise.git 2> /dev/nul
git clone https://github.com/maurosoria/dirsearch.git 2> /dev/nul
git clone https://github.com/sixdub/DomainTrustExplorer.git 2> /dev/nul
git clone https://github.com/ChrisTruncer/Egress-Assess.git 2> /dev/nul
git clone https://github.com/MacR6/ftpenum.git 2> /dev/nul
git clone https://github.com/ChrisTruncer/gnmap-parser.git 2> /dev/nul
git clone https://github.com/FortyNorthSecurity/Hasher.git 2> /dev/nul
git clone https://github.com/HarmJ0y/ImpDump.git 2> /dev/nul
git clone https://github.com/eladshamir/Internal-Monologue.git 2> /dev/nul
git clone https://github.com/HarmJ0y/KeeThief.git 2> /dev/nul
git clone https://github.com/xan7r/kerberoast.git 2> /dev/nul
git clone https://github.com/ChrisTruncer/mikto.git 2> /dev/nul
git clone https://github.com/xan7r/Misc.git 2> /dev/nul
git clone https://github.com/vysecurity/morphHTA.git 2> /dev/nul
git clone https://github.com/worawit/MS17-010.git 2> /dev/nul
git clone https://github.com/noahpowers/nlzr.git 2> /dev/nul
git clone https://github.com/PowerShellEmpire/PowerTools.git 2> /dev/nul
git clone https://github.com/NetSPI/PowerUpSQL.git 2> /dev/nul
git clone https://github.com/xorrior/RandomPS-Scripts.git 2> /dev/nul
git clone https://github.com/Arvanaghi/SessionGopher.git 2> /dev/nul
git clone https://github.com/mubix/shellshocker-pocs.git 2> /dev/nul
git clone https://github.com/SimplySecurity/SimplyEmail.git 2> /dev/nul
git clone https://github.com/SimplySecurity/SimplyTemplate.git 2> /dev/nul
git clone https://github.com/MacR6/sshenum.git 2> /dev/nul
git clone https://github.com/rasta-mouse/TikiTorch.git 2> /dev/nul
git clone https://github.com/frohoff/ysoserial.git 2> /dev/nul

# Apt dependency installs
echo -e  '\e[1;34m'"{::Installing tools/dependencies avaliable with APT::}"'\e[0m'
echo -e  '\e[1;34m'"{:seclists curl bloodhound enum4linux gobuster nbtscan nikto:]\e[0m" 
echo -e  '\e[1;34m'"{:nmap onesixtyone oscanner smbclient smbmap smtp-user-enum sslscan tnscmd10g whatweb:]\e[0m"
sudo DEBIAN_FRONTEND=noninteractive apt-get -y install crackmapexec bless eyewitness seclists curl bloodhound enum4linux gobuster nbtscan nikto nmap onesixtyone oscanner smbclient smbmap smtp-user-enum sslscan tnscmd10g whatweb mimikatz powershell-empire powersploit responder sublist3r
pip install mitm6

# AutoRecon Specific install
echo -e  '\e[1;34m'"{::Installing AutoRecon python dependencies::}"'\e[0m'
pip install -r /opt/Tools/AutoRecon/requirements.txt


# Installing Empire V3
echo -e  '\e[1;34m'"{::Installing Empire V3::}"'\e[0m'
pushd /opt/Tools/Empire
echo -e  "password" | bash "./setup/install.sh"
popd


# Extracting Bloodhound
echo -e  '\e[1;34m'"{::Extracting Bloodhound Ingestors::}"'\e[0m'
pushd /opt/Tools/BloodHound/
rm *.*
mv ./Ingestors/*.* ./
rm -rf Ingestors src 
rm BloodHoundExampleDB.graphdb
popd


# Install Veil Evasion
echo -e  '\e[1;34m'"{::Installing Veil 3.0::}"'\e[0m'
DEBIAN_FRONTEND=noninteractive apt-get -y install veil
/usr/share/veil/config/setup.sh --force --silent 2> /dev/null


# Install Nmap Vulners script
echo -e  '\e[1;34m'"{::Copying Vulners.nse to Nmap Scripts directory and update db::}"'\e[0m'
cp /opt/Tools/nmap-vulners/vulners.nse /usr/share/nmap/scripts
nmap --script-updatedb


#Extract Rockyou
echo -e  '\e[1;34m'"{::Extracting Rockyou::}"'\e[0m'
gzip -d /usr/share/wordlists/rockyou.txt.gz


# Update WPScan and Searchsploit
echo -e  '\e[1;34m'"{::Updating WPScan::}"'\e[0m'
wpscan --update
echo -e  '\e[1;34m'"{::Updating Searchsploit::}"'\e[0m'
searchsploit --update

#Throwaway User Creation
echo ‘Throwaway User Creation’;
sudo useradd -mp $(openssl passwd -1 1337P@ss) throwaway;
sudo usermod -s /bin/bash throwaway
sudo usermod -aG sudo throwaway;

#Build Tools Directories (both in user home and OPT depending on user preference)
echo -e  '\e[1;34m'"{::Creating linked Tool directories ~/Tools::}"'\e[0m'
sudo ln -s /opt/Tools /home/$1/

# Installing Aquatone
echo -e  '\e[1;34m'"{::Installing Aquatone::}"'\e[0m'
mkdir /opt/Tools/aquatone
cd /opt/Tools/aquatone
wget https://github.com/michenriksen/aquatone/releases/download/v1.7.0/aquatone_linux_amd64_1.7.0.zip 2> /dev/nul
unzip aquatone_linux_amd64_1*
rm aquatone*.zip

# Installing Evil-WinRM
echo -e  '\e[1;34m'"{::Installing Evil-WinRM::}"'\e[0m'
gem install evil-winrm

# Installing Impacket (updated version)
echo -e  '\e[1;34m'"{::Installing Impacket::}"'\e[0m'
pip install argparse pyasn1 pycryptodomex pyOpenSSL ldapdomaindump flask ldap3 tox
pip install /opt/Tools/impacket

# Install Nmap Vulners script
echo -e  '\e[1;34m'"{:: Vulners.nse update ::}"'\e[0m'
nmap --script-updatedb 2> /dev/nul

# Update WPScan and Searchsploit
echo -e  '\e[1;34m'"{::Updating WPScan::}"'\e[0m'
wpscan --update 2> /dev/nul
echo -e  '\e[1;34m'"{::Updating Searchsploit::}"'\e[0m'
searchsploit --update 2> /dev/nul

# Pasteable wordlist
echo '\e[1;34m'"{::Creating pastable file (This generates a file tree map of /usr/share/wordlists for easy cutting and pasting into xyz tool for input::}"'\e[0m'

sudo touch /home/$1/Desktop/Pastable.txt
sudo echo '/usr/share/wordlists/wfuzz/general/common.txt
/usr/share/wordlists/wfuzz/general/mutations_common.txt
/usr/share/wordlists/wfuzz/general/euskera.txt
/usr/share/wordlists/wfuzz/general/big.txt
/usr/share/wordlists/wfuzz/general/admin-panels.txt
/usr/share/wordlists/wfuzz/general/extensions_common.txt
/usr/share/wordlists/wfuzz/general/http_methods.txt
/usr/share/wordlists/wfuzz/general/catala.txt
/usr/share/wordlists/wfuzz/general/megabeast.txt
/usr/share/wordlists/wfuzz/general/spanish.txt
/usr/share/wordlists/wfuzz/general/test.txt
/usr/share/wordlists/wfuzz/general/medium.txt
/usr/share/wordlists/wfuzz/Injections/bad_chars.txt
/usr/share/wordlists/wfuzz/Injections/XML.txt
/usr/share/wordlists/wfuzz/Injections/All_attack.txt
/usr/share/wordlists/wfuzz/Injections/Traversal.txt
/usr/share/wordlists/wfuzz/Injections/SQL.txt
/usr/share/wordlists/wfuzz/Injections/XSS.txt
/usr/share/wordlists/wfuzz/others/names.txt
/usr/share/wordlists/wfuzz/others/common_pass.txt
/usr/share/wordlists/wfuzz/stress/uri_hex.txt
/usr/share/wordlists/wfuzz/stress/alphanum_case.txt
/usr/share/wordlists/wfuzz/stress/char.txt
/usr/share/wordlists/wfuzz/stress/doble_uri_hex.txt
/usr/share/wordlists/wfuzz/stress/test_ext.txt
/usr/share/wordlists/wfuzz/stress/alphanum_case_extra.txt
/usr/share/wordlists/wfuzz/vulns/sunas.txt
/usr/share/wordlists/wfuzz/vulns/weblogic.txt
/usr/share/wordlists/wfuzz/vulns/sql_inj.txt
/usr/share/wordlists/wfuzz/vulns/dirTraversal.txt
/usr/share/wordlists/wfuzz/vulns/dirTraversal-win.txt
/usr/share/wordlists/wfuzz/vulns/vignette.txt
/usr/share/wordlists/wfuzz/vulns/fatwire.txt
/usr/share/wordlists/wfuzz/vulns/dirTraversal-nix.txt
/usr/share/wordlists/wfuzz/vulns/fatwire_pagenames.txt
/usr/share/wordlists/wfuzz/vulns/iis.txt
/usr/share/wordlists/wfuzz/vulns/coldfusion.txt
/usr/share/wordlists/wfuzz/vulns/domino.txt
/usr/share/wordlists/wfuzz/vulns/oracle9i.txt
/usr/share/wordlists/wfuzz/vulns/iplanet.txt
/usr/share/wordlists/wfuzz/vulns/tomcat.txt
/usr/share/wordlists/wfuzz/vulns/cgis.txt
/usr/share/wordlists/wfuzz/vulns/websphere.txt
/usr/share/wordlists/wfuzz/vulns/jrun.txt
/usr/share/wordlists/wfuzz/vulns/tests.txt
/usr/share/wordlists/wfuzz/vulns/sharepoint.txt
/usr/share/wordlists/wfuzz/vulns/frontpage.txt
/usr/share/wordlists/wfuzz/vulns/netware.txt
/usr/share/wordlists/wfuzz/vulns/apache.txt
/usr/share/wordlists/wfuzz/webservices/ws-dirs.txt
/usr/share/wordlists/wfuzz/webservices/ws-files.txt'>>/home/$1/Desktop/Pastable.txt


echo  "/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/"
echo "CHANGE THE PASSWORD FOR THROWAWAY USER!!!!!!!!!!!"
echo "/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/"
echo "RUN: sudo passwd throwaway"
echo "Current password = 1337P@ss"